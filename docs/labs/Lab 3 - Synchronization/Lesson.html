<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-labs/Lab 3 - Synchronization/Lesson">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Lesson | Distributed Information Systems</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fesb-distributed-systems-2024.github.io/docs/labs/Lab 3 - Synchronization/Lesson"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lesson | Distributed Information Systems"><meta data-rh="true" name="description" content="Table Of Contents"><meta data-rh="true" property="og:description" content="Table Of Contents"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fesb-distributed-systems-2024.github.io/docs/labs/Lab 3 - Synchronization/Lesson"><link data-rh="true" rel="alternate" href="https://fesb-distributed-systems-2024.github.io/docs/labs/Lab 3 - Synchronization/Lesson" hreflang="en"><link data-rh="true" rel="alternate" href="https://fesb-distributed-systems-2024.github.io/docs/labs/Lab 3 - Synchronization/Lesson" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.1e0668cc.css">
<link rel="preload" href="/assets/js/runtime~main.1a5fcabf.js" as="script">
<link rel="preload" href="/assets/js/main.4b51d385.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/fesb.svg" alt="FESB Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/fesb.svg" alt="FESB Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Distributed Information Systems</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/labs">Labs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/project">Project</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/students/student-assignments">Students</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/students/homework-assignments">Homework Assignments</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/notes">Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/fesb-distributed-systems-2025/fesb-distributed-systems-2025.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/labs">Lab Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 0 - Environment Setup/Lesson">Lab 0 - Environment Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 1 - Git Basics/Cheatsheet">Lab 1 - Git Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 2 - Threads/Lesson">Lab 2 - Threads</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/labs/Lab 3 - Synchronization/Lesson">Lab 3 - Synchronization</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/labs/Lab 3 - Synchronization/Lesson">Lesson</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 4 - Communication Protocols/Lesson">Lab 4 - Communication Protocols</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 5 - HTTP Programming/Controller Example">Lab 5 - HTTP Programming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 6 - Web API Design/Lesson">Lab 6 - Web API Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 7 - Docker/Lesson">Lab 7 - Docker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/labs/Lab 8 - Web Sockets/Lesson">Lab 8 - Web Sockets</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/notes">Additional Information</a><button aria-label="Toggle the collapsible sidebar category &#x27;Additional Information&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/notes/Coding Conventions/Coding Convention">Coding Conventions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/Extra Materials">Extra Materials</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/project">Project Notes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Project Notes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/project/Phase 1/Homework">Phase 1</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/project/Phase 2/Homework">Phase 2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/project/Phase 3/Homework">Phase 3</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/project/Phase 4/Homework">Phase 4</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/project/Phase 5/Homework">Phase 5</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/students/homework-assignments">Students</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/students/homework-assignments">Homework Assignments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/students/student-assignments">Student Assignments</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/labs"><span itemprop="name">Lab Guides</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Lab 3 - Synchronization</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lesson</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lesson</h1><h1>Lab 3: Synchronization</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table Of Contents<a class="hash-link" href="#table-of-contents" title="Direct link to heading">​</a></h2><ul><li><a href="#lesson">Lesson</a></li><li><a href="#lab-3-synchronization">Lab 3: Synchronization</a><ul><li><a href="#table-of-contents">Table Of Contents</a></li><li><a href="#exercise-1-utilizing-multiple-cores"><strong>Exercise 1: Utilizing Multiple Cores</strong></a><ul><li><a href="#create-a-project"><strong>Create a Project</strong></a></li><li><a href="#run-project"><strong>Run Project</strong></a></li></ul></li><li><a href="#exercise-2-implementing-spin-locks"><strong>Exercise 2: Implementing Spin-Locks</strong></a><ul><li><a href="#create-a-project-1"><strong>Create a Project</strong></a></li><li><a href="#run-the-project"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-3-using-kernel-mode-synchronizations"><strong>Exercise 3: Using Kernel-mode Synchronizations</strong></a><ul><li><a href="#create-a-project-2"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-1"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-4-producer-and-consumer"><strong>Exercise 4: Producer and Consumer</strong></a><ul><li><a href="#create-a-project-3"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-2"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-5-multiple-producers-and-consumers"><strong>Exercise 5: Multiple Producers and Consumers</strong></a><ul><li><a href="#create-a-project-4"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-3"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-6-provoking-a-deadlock"><strong>Exercise 6: Provoking a Deadlock</strong></a><ul><li><a href="#create-a-project-5"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-4"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-7-avoiding-deadlocks"><strong>Exercise 7: Avoiding Deadlocks</strong></a><ul><li><a href="#create-a-project-6"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-5"><strong>Run the project</strong></a></li></ul></li><li><a href="#homework"><strong>Homework</strong></a><ul><li><a href="#setup"><strong>Setup</strong></a></li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-1-utilizing-multiple-cores"><strong>Exercise 1: Utilizing Multiple Cores</strong><a class="hash-link" href="#exercise-1-utilizing-multiple-cores" title="Direct link to heading">​</a></h2><p>In this exercise you will use methods from .NET framework to perform atomic (uninterruptable) updates on primitive data types.</p><p>The overheads of using threads:</p><ol><li>Starting a thread</li><li>Scheduling a thread (context switch)</li><li>Synchronizing a thread (+ associated (big) problems)</li><li>Cache misses</li><li>Destroying a thread</li></ol><p>Advice: Avoid 1, 3, and 4!!!</p><p>If you access shared variables (e.g. static and instance fields) you should use synchronization mechanisms.</p><p>Local variables are not shared unless they are passed to lambda expressions. In that case, local variables are implicitly captured into objects by the compiler.</p><p>Thread-safety in FCL methods:</p><ul><li>All FCL static methods are thread-safe. Most parameters are passed by value and FCL internally they use locks only if necessary.</li><li>Instance methods are not thread-safe since the overhead of locking would hurt performance.</li></ul><p>Primitives (methods) that are used for synchronization can be:</p><ul><li><p>User-mode constructs</p><ul><li>They are fast since they use special CPU instructions to coordinate threads.</li><li>Windows and thread pool do not detect that a thread blocks using these synchronization primitives.</li><li>But, you cannot suspend a thread waiting on a user-mode synchronization primitive.</li></ul></li><li><p>Kernel-mode constructs</p><ul><li>Synchronization primitives are implemented in the Windows kernel so a transition for user to kernel mode is executed.</li><li>The kernel is able to suspend threads that wait on these synchronization constructs.</li></ul></li><li><p>Hybrid constructs</p><ul><li>Run as non-blocking when there is no contention. When there is a contention thread are blocked by the operating system.</li></ul></li></ul><p>In .NET you can use the following user-mode constructs:</p><ul><li><p>Volatile Constructs</p><ul><li>These constructs are used to perform atomic read or atomic write operations but they cannot be combined into atomic read/modify/write operations.</li></ul></li><li><p>Interlocked operations</p><ul><li>These constructs provide atomic read/modify/write operations.  They all are full memory fences.</li></ul></li></ul><p>A <strong>memory fence</strong> ensures that:</p><ul><li>All writes before an interlocked method are executed before the call to the Interlocked method.</li><li>All reads after the call to the interlocked method must execute after the call to the interlocked method.  </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.AtomicOperations</code> in solution <code>Synchronization</code>.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new sln --name Synchronization</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.AtomicOperations</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.AtomicOperations/Synchronization.AtomicOperations.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Use the following namespaces in file <code>Program.cs</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following constants and fields to class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> IncrementAmount </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10_000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">volatile</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> s_volatileSum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> s_interlockedSum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> s_normalSum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>IncrementSums</code> as follows:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">IncrementSums</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> IncrementAmount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_volatileSum</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Interlocked</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Increment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">ref</span><span class="token plain"> s_interlockedSum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_normalSum</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>Main</code> as follows:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> numberOfCores </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ProcessorCount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;You have </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">numberOfCores</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> cores installed.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> tasks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">List</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> _ </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> Enumerable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Range</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> numberOfCores</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> task </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">IncrementSums</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Volatile sum: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">s_volatileSum</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Interlocked sum: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">s_interlockedSum</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Normal sum: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">s_normalSum</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-project"><strong>Run Project</strong><a class="hash-link" href="#run-project" title="Direct link to heading">​</a></h3><p>Execute the project and the output similar to the following will appear:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.AtomicOperations/Synchronization.AtomicOperations.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">You have </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> cores installed.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Volatile sum: </span><span class="token number" style="color:rgb(9, 134, 88)">99769</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Interlocked sum: </span><span class="token number" style="color:rgb(9, 134, 88)">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Normal sum: </span><span class="token number" style="color:rgb(9, 134, 88)">99989</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-2-implementing-spin-locks"><strong>Exercise 2: Implementing Spin-Locks</strong><a class="hash-link" href="#exercise-2-implementing-spin-locks" title="Direct link to heading">​</a></h2><p>In this exercise you will use user level constructs to implement spin waiting.</p><p><img loading="lazy" alt="mutual-exclusion" src="/assets/images/mutual-exclusion-5ef06c6075a8f8359fe12e9feaf4c581.png" width="720" height="540" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project-1"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project-1" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.InterlockedOperations</code> in solution <code>Synchronization</code>.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.InterlockedOperations</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.InterlockedOperations/Synchronization.InterlockedOperations.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Use the following namespaces in file Program.cs:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>AddNumbers</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">AddNumbers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> threadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Interlocked</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Exchange</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">ref</span><span class="token plain"> s_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">threadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is waiting for lock to release&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">300</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">threadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> has acquired lock&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_total </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;total = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> s_total</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_total </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;total = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> s_total</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_total </span><span class="token operator" style="color:rgb(0, 0, 0)">*=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;total = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> s_total</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">threadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is about to release lock&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">VolatileWrite</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">ref</span><span class="token plain"> s_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>Main</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> tasks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">AddNumbers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">AddNumbers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">AddNumbers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-project"><strong>Run the project</strong><a class="hash-link" href="#run-the-project" title="Direct link to heading">​</a></h3><ul><li>Execute the project and the output similar to the following will appear:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.InterlockedOperations/Synchronization.InterlockedOperations.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> has acquired lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> is waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> lock to release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> is waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> lock to release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> is about to release lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> has acquired lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> is about to release lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> is waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> lock to release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> has acquired lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">total </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> is about to release lock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-3-using-kernel-mode-synchronizations"><strong>Exercise 3: Using Kernel-mode Synchronizations</strong><a class="hash-link" href="#exercise-3-using-kernel-mode-synchronizations" title="Direct link to heading">​</a></h2><p>In this exercise you will use kernel mode synchronizations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project-2"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project-2" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.KernelSynchronizations</code> in solution <code>Synchronization</code>.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.KernelSynchronizations</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.KernelSynchronizations/Synchronization.KernelSynchronizations.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following fields to class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">AutoResetEvent</span><span class="token plain"> s_autoRaiseEvent </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Semaphore</span><span class="token plain"> s_semaphore </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Random</span><span class="token plain"> s_random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">object</span><span class="token plain"> s_lock </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>DoSomething</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">DoSomething</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Waiting for auto raise event to be signaled ...&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_autoRaiseEvent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WaitOne</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;autoRaiseEvent is signaled.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>DoConcurrentOperationWithSemaphore</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">DoConcurrentOperationWithSemaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> managedThreadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is waiting to enter semaphore&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_semaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WaitOne</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> entered semaphore&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Delay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TimeSpan</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">FromSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> randomNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">randomNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token keyword" style="color:rgb(0, 0, 255)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">NotSupportedException</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Uh oh, bad thing happened in thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">NotSupportedException</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ForegroundColor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ConsoleColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Red</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Exception occurred on thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">ResetColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">finally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is about to exit semaphore&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_semaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Release</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>DoConcurrentOperationWithLock</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">DoConcurrentOperationWithLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> managedThreadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is waiting to enter lock&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_lock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> entered lock&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TimeSpan</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">FromSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> left lock&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>Main</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> autoRaiseEventTask </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoSomething</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Press any key to signal raise autoRaiseEvent signal ...&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">ReadKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_autoRaiseEvent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> autoRaiseEventTask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> semaphoreTasks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoConcurrentOperationWithSemaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoConcurrentOperationWithSemaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoConcurrentOperationWithSemaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoConcurrentOperationWithSemaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">DoConcurrentOperationWithSemaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">semaphoreTasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> lockTasks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoConcurrentOperationWithLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">DoConcurrentOperationWithLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">DoConcurrentOperationWithLock</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">lockTasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_autoRaiseEvent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Dispose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_semaphore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Dispose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-project-1"><strong>Run the project</strong><a class="hash-link" href="#run-the-project-1" title="Direct link to heading">​</a></h3><ul><li>Execute the project and the output similar to the following will appear:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.KernelSynchronizations/Synchronization.KernelSynchronizations.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Press any key to signal raise autoRaiseEvent signal </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> auto raise event to be signaled </span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">autoRaiseEvent is signaled.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> is waiting to enter semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> is waiting to enter semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> entered semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> is waiting to enter semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> is waiting to enter semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> is waiting to enter semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> is about to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> entered semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> is about to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> entered semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Exception occurred on thread </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> is about to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> entered semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> is about to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> entered semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Exception occurred on thread </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">9</span><span class="token plain"> is about to </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><span class="token plain"> semaphore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> is waiting to enter lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> entered lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"> is waiting to enter lock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> is waiting to enter lock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-4-producer-and-consumer"><strong>Exercise 4: Producer and Consumer</strong><a class="hash-link" href="#exercise-4-producer-and-consumer" title="Direct link to heading">​</a></h2><p>In this exercise you will implement a classical synchronization problem.</p><p>A producer produces items and stores them in a shared buffer.
The consumer takes items from the buffer and consumes them.</p><p><img loading="lazy" alt="circular-buffer" src="/assets/images/circular-buffer-de98b6055fa41f99b6a053b4d683ee36.png" width="720" height="540" class="img_ev3q">
<img loading="lazy" alt="coordinating-threads" src="/assets/images/coordinating-threads-3b7e34aabf5b3a3b0c3cdf3e6eb6fae1.png" width="720" height="540" class="img_ev3q"></p><p>The following steps are vital for the algorithm:</p><ul><li>When the buffer is full the producer goes to sleep</li><li>When the buffer is empty the consumer goes to sleep</li><li>When there is one empty slot in the buffer the consumer wakes up the producer</li><li>When there is one full slot in the buffer the producer wakes up the consumer.</li></ul><p>The programmer should avoid <strong>deadlocks</strong> and/or <strong>starvation&#x27;s</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project-3"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project-3" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.ProducerConsumer</code> in solution <code>Synchronization</code>:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.ProducerConsumer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.ProducerConsumer/Synchronization.ProducerConsumer.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>SharedBuffer</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">namespace</span><span class="token plain"> </span><span class="token namespace">Synchronization</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">ProducerConsumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">SharedBuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> _buffer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> _numberOfOccupiedElements</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> _elementIndexToPut</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> _elementIndexToTakeFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">object</span><span class="token plain"> _locker </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>In class <code>SharedBuffer</code> implement method <code>PutElement</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">PutElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> managedThreadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_numberOfOccupiedElements </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is waiting&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Monitor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">_elementIndexToPut</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _numberOfOccupiedElements</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _elementIndexToPut </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_elementIndexToPut </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Write</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;{0:d2} &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Monitor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Pulse</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>In class <code>SharedBuffer</code> implement method <code>GetElement</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> managedThreadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_numberOfOccupiedElements </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is waiting&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Monitor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> element </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">_elementIndexToTakeFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">_elementIndexToTakeFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _numberOfOccupiedElements</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _elementIndexToTakeFrom </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_elementIndexToTakeFrom </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Write</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_buffer</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token interpolation-string interpolation expression language-csharp">i</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token interpolation-string interpolation format-string punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token interpolation-string interpolation format-string">d2</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Monitor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Pulse</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>Producer</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Producer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">SharedBuffer</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Random</span><span class="token plain"> _random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">SharedBuffer</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _buffer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Produce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">PutElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>Consumer</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Consumer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">SharedBuffer</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Random</span><span class="token plain"> _random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">SharedBuffer</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _buffer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Consume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">500</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            sum </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> _buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">GetElement</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Sum should be &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Thank you kleine Karl: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> sum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following fields to class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">SharedBuffer</span><span class="token plain"> s_buffer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Producer</span><span class="token plain"> s_producer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Consumer</span><span class="token plain"> s_consumer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_buffer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>Main</code> in class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> t1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Produce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> t2 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Consume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-project-2"><strong>Run the project</strong><a class="hash-link" href="#run-the-project-2" title="Direct link to heading">​</a></h3><ul><li>Execute the project and the output similar to the following will appear:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.ProducerConsumer/Synchronization.ProducerConsumer.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Thread </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> is waiting</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 01 00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 02 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 02 03 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 03 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 03 04 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 04 00 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 04 05 00 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 04 05 06 00 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 04 05 06 07 00 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 04 05 06 07 08 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 00 05 06 07 08 00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">00 00 00 00 00 05 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> 00 00 00 00 05 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> 00 00 00 05 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> 00 00 05 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> 00 00 00 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> 00 00 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> 00 06 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> 00 00 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 00 07 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> 00 00 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">13</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">16</span><span class="token plain"> 00 08 09</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-5-multiple-producers-and-consumers"><strong>Exercise 5: Multiple Producers and Consumers</strong><a class="hash-link" href="#exercise-5-multiple-producers-and-consumers" title="Direct link to heading">​</a></h2><p>In this exercise you will use C# <code>System.Threading.Channels.Channel</code> to implement multiple producers and consumers:</p><p><img loading="lazy" alt="producers-consumers" src="/assets/images/producer-consumer-08192f13113e2fdbf132d12b8292b869.svg" width="521" height="141" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project-4"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project-4" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.MultipleProducersConsumers</code> in solution <code>Synchronization</code>:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.MultipleProducersConsumers</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.MultipleProducersConsumers/Synchronization.MultipleProducersConsumers.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>Producer</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Producer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Random</span><span class="token plain"> _random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> _name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ChannelWriter</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> _channelWriter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ChannelWriter</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> writer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _channelWriter </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> writer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Produce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> delay </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">FromMilliseconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Delay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">delay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> _channelWriter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteAsync</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Producer </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> wrote </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">i</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> to channel.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>Consumer</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Consumer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Random</span><span class="token plain"> _random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> _name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ChannelReader</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> _channelReader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ChannelReader</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> channelReader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _channelReader </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> channelReader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token return-type class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token return-type class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Consume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> data </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> _channelReader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">ReadAllAsync</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> delay </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">FromMilliseconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">500</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Delay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">delay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            sum </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Consumer </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> read </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">data</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> from channel.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> sum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following field to class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Channel</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> s_channel </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token generic-method function" style="color:rgb(0, 0, 255)">CreateBounded</span><span class="token generic-method generic class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token generic-method generic class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token generic-method generic class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">BoundedChannelOptions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        FullMode </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> BoundedChannelFullMode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Wait</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following implementation to method <code>Main</code> in class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> producers </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Producer1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s_channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Writer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Producer2&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">s_channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Writer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Producer3&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">s_channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Writer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> producerTasks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">List</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> producer </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> producers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> producerTask </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> producer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Produce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            producerTasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">producerTask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> consumers </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Consumer1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s_channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Reader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Consumer2&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s_channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Reader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> consumerTasks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">List</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&lt;</span><span class="token constructor-invocation class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token constructor-invocation class-name punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> consumer </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> consumers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> consumerTask </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> consumer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Consume</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            consumerTasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Add</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">consumerTask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">producerTasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        s_channel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Writer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Complete</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> consumerTask </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> consumerTasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            sum </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> consumerTask</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Expected sum: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">99</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">*</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">100</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">/</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">2</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">*</span><span class="token interpolation-string interpolation expression language-csharp"> producers</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token interpolation-string interpolation expression language-csharp">Length</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Actual sum: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">sum</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-project-3"><strong>Run the project</strong><a class="hash-link" href="#run-the-project-3" title="Direct link to heading">​</a></h3><ul><li>Execute the project and the output similar to the following will appear:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.MultipleProducersConsumers/Synchronization.MultipleProducersConsumers.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer2 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer1 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer1 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer2 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer2 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer1 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer2 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Producer Producer1 wrote </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> to channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Consumer Consumer1 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> from channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Consumer Consumer3 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> from channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Consumer Consumer2 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">98</span><span class="token plain"> from channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Consumer Consumer3 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">96</span><span class="token plain"> from channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Consumer Consumer1 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token plain"> from channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Consumer Consumer2 </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token plain"> from channel.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Expected sum: </span><span class="token number" style="color:rgb(9, 134, 88)">9900</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Actual sum: </span><span class="token number" style="color:rgb(9, 134, 88)">9900</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-6-provoking-a-deadlock"><strong>Exercise 6: Provoking a Deadlock</strong><a class="hash-link" href="#exercise-6-provoking-a-deadlock" title="Direct link to heading">​</a></h2><p>In this exercise you will provoke a deadlock when two threads are trying to acquire two different locks in the same order.</p><p><img loading="lazy" alt="deadlock" src="/assets/images/deadlock-4ad5155be0bd23d7e13bf4eb7ffc43e3.png" width="720" height="540" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project-5"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project-5" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.ProvokingDeadLock</code> in solution <code>Synchronization</code>:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.ProvokingDeadLock</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.ProvokingDeadLock/Synchronization.ProvokingDeadLock.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>Account</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">object</span><span class="token plain"> _locker </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> _name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> _balance</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Account</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> balance</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _balance </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> balance</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Withdraw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _balance </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Deposit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _balance </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">override</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ToString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Ballance: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_balance</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>Transfer</code> in class <code>Account</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Transfer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">other </span><span class="token keyword" style="color:rgb(0, 0, 255)">is</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> managedThreadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> acquired lock 1.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> trying to acquire lock 2.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">lock</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">_locker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> acquired lock 2.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token function" style="color:rgb(0, 0, 255)">Withdraw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Deposit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> performed transfer and is releasing lock 2.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Thread </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> is releasing 1.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following fields to class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"> s_firstAccount </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;First Account&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"> s_secondAccount </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Second Account&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">300</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>Main</code> in class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> t1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> s_firstAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Transfer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_secondAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">//var t2 = Task.Run(() =&gt; a.Transfer(b, 100));</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> t2 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> s_secondAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Transfer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_firstAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Balances: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">s_firstAccount</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">s_secondAccount</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-project-4"><strong>Run the project</strong><a class="hash-link" href="#run-the-project-4" title="Direct link to heading">​</a></h3><ul><li>Execute the project and the output similar to the following will appear:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.ProvokingDeadLock/Synchronization.ProvokingDeadLock.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account Second Account Thread </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> acquired lock </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First Account Thread </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> acquired lock </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First Account Thread </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> trying to acquire lock </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account Second Account Thread </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> trying to acquire lock </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-7-avoiding-deadlocks"><strong>Exercise 7: Avoiding Deadlocks</strong><a class="hash-link" href="#exercise-7-avoiding-deadlocks" title="Direct link to heading">​</a></h2><p>In this exercise you will use kernel synchronization primitives to avoid deadlocks situations.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-project-6"><strong>Create a Project</strong><a class="hash-link" href="#create-a-project-6" title="Direct link to heading">​</a></h3><ul><li>Create a C# Console project, named <code>Synchronization.Mutexes</code> in solution <code>Synchronization</code>:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dotnet new console --name Synchronization.Mutexes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dotnet sln </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> Synchronization.Mutexes/Synchronization.Mutexes.csproj</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create and implement class <code>Account</code> in new file:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">namespace</span><span class="token plain"> </span><span class="token namespace">Synchronization</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Mutexes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> Timeout </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> _name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> _balance</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Mutex</span><span class="token plain"> _mutex </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Account</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> balance</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _balance </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> balance</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Withdraw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _balance </span><span class="token operator" style="color:rgb(0, 0, 0)">-=</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Deposit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        _balance </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">override</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ToString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> Ballance: </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_balance</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>Transfer</code> in class <code>Account</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Transfer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">decimal</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">other </span><span class="token keyword" style="color:rgb(0, 0, 255)">is</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> managedThreadId </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">CurrentManagedThreadId</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">Mutex</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> lockers </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> _mutex</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">_mutex </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">WaitHandle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WaitAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">lockers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Timeout</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> T</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">: All locks are acquired.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token function" style="color:rgb(0, 0, 255)">Withdraw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Thread</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sleep</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                other</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Deposit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> T</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">: Transfer is performed.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">finally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token keyword" style="color:rgb(0, 0, 255)">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> mutex </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> lockers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                    mutex</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">ReleaseMutex</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Account </span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">_name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)"> T</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">managedThreadId</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">: All locks are released.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Add following fields to class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"> s_firstAccount </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;First&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Account</span><span class="token plain"> s_secondAccount </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Second&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">300</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Implement method <code>Main</code> in class <code>Program</code>:</li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> t1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> s_firstAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Transfer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_secondAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> t2 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> s_firstAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Transfer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s_secondAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// var t2 = Task.Run(() =&gt; s_secondAccount.Transfer(s_firstAccount, 100));</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WhenAll</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">t1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Console</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Balances: {0} {1}&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s_firstAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s_secondAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-project-5"><strong>Run the project</strong><a class="hash-link" href="#run-the-project-5" title="Direct link to heading">​</a></h3><ul><li>Execute the project and the output similar to the following will appear:</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ dotnet run --project Synchronization.Mutexes/Synchronization.Mutexes.csproj</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First T4: All locks are acquired.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First T4: Transfer is performed.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First T4: All locks are released.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First T6: All locks are acquired.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First T6: Transfer is performed.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Account First T6: All locks are released.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Balances: Account: First Ballance: </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> Account: Second Ballance: </span><span class="token number" style="color:rgb(9, 134, 88)">500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="homework"><strong>Homework</strong><a class="hash-link" href="#homework" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup"><strong>Setup</strong><a class="hash-link" href="#setup" title="Direct link to heading">​</a></h3><p>Create <code>data.txt</code> file using code below:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">// Program.cs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// © 2022 FESB in cooperation with Zoraja Consulting. All rights reserved.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">IO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token namespace">System</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Threading</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">Tasks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">namespace</span><span class="token plain"> </span><span class="token namespace">Csharp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Program</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> NumberOfRows </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100_000_000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">readonly</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Random</span><span class="token plain"> s_random </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token return-type class-name" style="color:rgb(38, 127, 153)">Task</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> userFolder </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">GetFolderPath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SpecialFolder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UserProfile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> outputFilePath </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Combine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">userFolder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">@&quot;Downloads\data.txt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> outputFileStream </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">FileStream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">outputFilePath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> FileMode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">OpenOrCreate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">using</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> streamWriter </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name" style="color:rgb(38, 127, 153)">StreamWriter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">outputFileStream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> streamWriter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLineAsync</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Type;OIB;Name;Gender;DateOfBirth;AvgGrade;Paycheck&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> NumberOfRows</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> personRandomNumber </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> row </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> personRandomNumber </span><span class="token keyword" style="color:rgb(0, 0, 255)">switch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetInvalidRowString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetProfessorRowString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                _ </span><span class="token operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetStudentRowString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> streamWriter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">WriteLineAsync</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">row</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetProfessorRowString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> rowNumber</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> isProfessorErrorRow </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> isProfessorErrorRow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Professor;error;error;error;error;error;error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Professor;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">*</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">3478931L</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">%</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">100000000</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;Name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">%</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">2</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">==</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">0</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">?</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp string" style="color:rgb(163, 21, 21)">&quot;Male&quot;</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp string" style="color:rgb(163, 21, 21)">&quot;Female&quot;</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;11/1/1999;;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">%</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">15</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">*</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">1000</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetStudentRowString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">int</span><span class="token plain"> rowNumber</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> isStudentErrorRow </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> s_random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Next</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> isStudentErrorRow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Student;error;error;error;error;error;error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;Student;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">*</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">3478931L</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">%</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">100000000</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;Name</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">%</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">2</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">==</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">0</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">?</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp string" style="color:rgb(163, 21, 21)">&quot;Male&quot;</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp string" style="color:rgb(163, 21, 21)">&quot;Female&quot;</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;11/1/1999;</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp">rowNumber </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:rgb(0, 0, 0)">%</span><span class="token interpolation-string interpolation expression language-csharp"> </span><span class="token interpolation-string interpolation expression language-csharp number" style="color:rgb(9, 134, 88)">5</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">GetInvalidRowString</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;error;error;error;error;error;error;error&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Your task is to:</p><ul><li>parse these people into appropriate objects (you can reuse code from previous labs):</li><li>Display in console rows with preserved row number:<ul><li>error rows with red color</li><li>students with grade below <code>1</code> with yellow color</li><li>students with green color</li><li>professors with blue color</li></ul></li><li>Write rows into files:<ul><li>write all invalid rows into <code>error-rows.txt</code> file</li><li>write all students with grade <code>1</code> or below into <code>failed-students.txt</code> file</li><li>write all students with grade above <code>1</code> into <code>passed-students.txt</code> file</li><li>write all professor into <code>professors.txt</code> file</li></ul></li><li>write code that is memory and performance optimized. (Hint: use async await, tasks and producer consumers pattern)</li></ul><p><strong>Notes:</strong></p><ul><li>This code will generate file which is about 5GB&#x27;s in size.</li><li>Do not attempt to load whole file into memory at once</li><li>Use async await where ever you can</li><li>Throwing exceptions is slow</li><li>Changing colors with <code>Console.ForegroundColor = ConsoleColor.Yellow</code>:<ul><li>might cause race conditions since multiple threads might be outputting to console.</li><li>use following class to encode colors of text in console:</li></ul></li></ul><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">/// &lt;summary&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">/// ANSI text format utility.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">/// &lt;/summary&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">AnsiUtility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> RedColor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;31&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> GreenColor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;32&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> YellowColor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;33&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> BlueColor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;34&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> WhiteColor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;37&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">EncodeForegroundWithRedColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Encode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> RedColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">EncodeForegroundWithGreenColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Encode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> GreenColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">EncodeForegroundWithYellowColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Encode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> YellowColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">EncodeForegroundWithBlueColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Encode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> BlueColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">EncodeForegroundWithWhiteColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Encode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> WhiteColor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">Encode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">string</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">params</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(0, 0, 255)">object</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">?</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token class-name punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">$&quot;\u001b[</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:rgb(0, 0, 255)">string</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token interpolation-string interpolation expression language-csharp function" style="color:rgb(0, 0, 255)">Join</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token interpolation-string interpolation expression language-csharp string" style="color:rgb(163, 21, 21)">&quot;;&quot;</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token interpolation-string interpolation expression language-csharp"> parameters</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">m</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:rgb(0, 0, 255)">value</span><span class="token interpolation-string interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token interpolation-string string" style="color:rgb(163, 21, 21)">\u001b[0m&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/labs/Lab 2 - Threads/Preparation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Preparation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/labs/Lab 4 - Communication Protocols/Lesson"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lesson</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table Of Contents</a></li><li><a href="#exercise-1-utilizing-multiple-cores" class="table-of-contents__link toc-highlight"><strong>Exercise 1: Utilizing Multiple Cores</strong></a><ul><li><a href="#create-a-project" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-project" class="table-of-contents__link toc-highlight"><strong>Run Project</strong></a></li></ul></li><li><a href="#exercise-2-implementing-spin-locks" class="table-of-contents__link toc-highlight"><strong>Exercise 2: Implementing Spin-Locks</strong></a><ul><li><a href="#create-a-project-1" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-the-project" class="table-of-contents__link toc-highlight"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-3-using-kernel-mode-synchronizations" class="table-of-contents__link toc-highlight"><strong>Exercise 3: Using Kernel-mode Synchronizations</strong></a><ul><li><a href="#create-a-project-2" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-1" class="table-of-contents__link toc-highlight"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-4-producer-and-consumer" class="table-of-contents__link toc-highlight"><strong>Exercise 4: Producer and Consumer</strong></a><ul><li><a href="#create-a-project-3" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-2" class="table-of-contents__link toc-highlight"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-5-multiple-producers-and-consumers" class="table-of-contents__link toc-highlight"><strong>Exercise 5: Multiple Producers and Consumers</strong></a><ul><li><a href="#create-a-project-4" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-3" class="table-of-contents__link toc-highlight"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-6-provoking-a-deadlock" class="table-of-contents__link toc-highlight"><strong>Exercise 6: Provoking a Deadlock</strong></a><ul><li><a href="#create-a-project-5" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-4" class="table-of-contents__link toc-highlight"><strong>Run the project</strong></a></li></ul></li><li><a href="#exercise-7-avoiding-deadlocks" class="table-of-contents__link toc-highlight"><strong>Exercise 7: Avoiding Deadlocks</strong></a><ul><li><a href="#create-a-project-6" class="table-of-contents__link toc-highlight"><strong>Create a Project</strong></a></li><li><a href="#run-the-project-5" class="table-of-contents__link toc-highlight"><strong>Run the project</strong></a></li></ul></li><li><a href="#homework" class="table-of-contents__link toc-highlight"><strong>Homework</strong></a><ul><li><a href="#setup" class="table-of-contents__link toc-highlight"><strong>Setup</strong></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 FESB in cooperation with Zoraja Consulting.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1a5fcabf.js"></script>
<script src="/assets/js/main.4b51d385.js"></script>
</body>
</html>