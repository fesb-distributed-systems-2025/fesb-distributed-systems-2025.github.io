"use strict";(self.webpackChunkdistributed_systems=self.webpackChunkdistributed_systems||[]).push([[579],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(n),m=s,g=d["".concat(l,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(g,r(r({ref:t},u),{},{components:n})):a.createElement(g,r({ref:t},u))}));function m(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,r=new Array(i);r[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:s,r[1]=o;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4251:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(7462),s=(n(7294),n(3905));const i={},r="Lesson",o={unversionedId:"labs/Lab 8 - Data Manage and Migrations/Lesson",id:"labs/Lab 8 - Data Manage and Migrations/Lesson",title:"Lesson",description:"Table of Contents",source:"@site/docs/labs/08.Lab 8 - Data Manage and Migrations/Lesson.md",sourceDirName:"labs/08.Lab 8 - Data Manage and Migrations",slug:"/labs/Lab 8 - Data Manage and Migrations/Lesson",permalink:"/docs/labs/Lab 8 - Data Manage and Migrations/Lesson",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Homework",permalink:"/docs/labs/Lab 8 - Data Manage and Migrations/Homework"},next:{title:"Homework",permalink:"/docs/labs/Lab 9 - Microservices/Homework"}},l={},c=[{value:"<strong>Table of Contents</strong>",id:"table-of-contents",level:2},{value:"<strong>Requirements</strong>",id:"requirements",level:3},{value:"<strong>Objectives</strong>",id:"objectives",level:3},{value:"<strong>Exercise 1: Implement Code First conventions</strong>",id:"exercise-1-implement-code-first-conventions",level:2},{value:"<strong>Defining Relationships in Classes</strong>",id:"defining-relationships-in-classes",level:3},{value:"<strong>Codebook tables</strong>",id:"codebook-tables",level:3},{value:"<strong>Exercise 2: Creating Migrations</strong>",id:"exercise-2-creating-migrations",level:2}],u={toc:c};function p(e){let{components:t,...i}=e;return(0,s.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"lesson"},"Lesson"),(0,s.kt)("h1",{id:"lab-8-data-manage-and-migrations"},"Lab 8: Data Manage and Migrations"),(0,s.kt)("h2",{id:"table-of-contents"},(0,s.kt)("strong",{parentName:"h2"},"Table of Contents")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#lesson"},"Lesson")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#lab-8-data-manage-and-migrations"},"Lab 8: Data Manage and Migrations"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#table-of-contents"},(0,s.kt)("strong",{parentName:"a"},"Table of Contents")),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#requirements"},(0,s.kt)("strong",{parentName:"a"},"Requirements"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#objectives"},(0,s.kt)("strong",{parentName:"a"},"Objectives"))))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#implement-code-first-conventions"},(0,s.kt)("strong",{parentName:"a"},"Exercise 1: Implement Code First conventions")),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#defining-relationships-in-classes"},(0,s.kt)("strong",{parentName:"a"},"Defining Relationships in Classes"))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#codebook-tables"},(0,s.kt)("strong",{parentName:"a"},"Codebook tables"))))),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"#creating-migrations"},(0,s.kt)("strong",{parentName:"a"},"Exercise 2: Creating Migrations")))))),(0,s.kt)("h3",{id:"requirements"},(0,s.kt)("strong",{parentName:"h3"},"Requirements")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://info.microsoft.com/ww-landing-sql-server-2022.html?culture=en-us&country=us"},"SQL Server 2022 or newer"))),(0,s.kt)("p",null,"In downloaded exec file choose Custom installation and install LocalDb instance (named: (localdb)\\MSSQLLocalDB)"),(0,s.kt)("h3",{id:"objectives"},(0,s.kt)("strong",{parentName:"h3"},"Objectives")),(0,s.kt)("p",null,"In this LAB you will learn create database via .NET DbContext using migrations, Code First approach with conventions and manage data fom database."),(0,s.kt)("h2",{id:"exercise-1-implement-code-first-conventions"},(0,s.kt)("strong",{parentName:"h2"},"Exercise 1: Implement Code First conventions")),(0,s.kt)("p",null,"In this course, we use the Code-First approach when working with databases. This means that we first create entity classes (models) in .NET, and the database is generated automatically from those classes."),(0,s.kt)("p",null,"Each entity class represents a database table, and class properties represent table columns. Entity Framework Core uses conventions to determine table names, primary keys, relationships (foreign keys), and data types. These conventions reduce the need for manual configuration. But, in some cases we need manual configuration, so because of it we have configuration file for each domain class."),(0,s.kt)("p",null,"Official Microsoft documentation (in left side bar look out Built-in conventions, Custom conventions and Model conventions):"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://learn.microsoft.com/en-us/ef/ef6/modeling/code-first/conventions/built-in"},"Find more about conventions here"))),(0,s.kt)("h3",{id:"defining-relationships-in-classes"},(0,s.kt)("strong",{parentName:"h3"},"Defining Relationships in Classes")),(0,s.kt)("p",null,"One-to-Many Relationship"),(0,s.kt)("p",null,"A navigation property allows you to navigate from one entity to related entities.\nA reverse navigation property allows navigation in the opposite direction."),(0,s.kt)("p",null,"Example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-csharp"},"public class Student\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n\n    public ICollection<Course> Courses { get; set; }\n}\n\npublic class Course\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n\n    public int StudentId { get; set; }\n    public Student Student { get; set; }\n}\n")),(0,s.kt)("p",null,"Many-to-Many (N-N) Relationship"),(0,s.kt)("p",null,"For many-to-many relationships, it is recommended to manually create a third entity (junction table) instead of letting EF Core create it automatically."),(0,s.kt)("p",null,"This gives you more control and allows you to add extra fields if needed."),(0,s.kt)("p",null,"Example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-csharp"},"public class Student\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n\n    public ICollection<StudentCourse> StudentCourses { get; set; }\n}\n\npublic class Course\n{\n    public int Id { get; set; }\n    public string Title { get; set; }\n\n    public ICollection<StudentCourse> StudentCourses { get; set; }\n}\n\npublic class StudentCourse\n{\n    public int StudentId { get; set; }\n    public Student Student { get; set; }\n\n    public int CourseId { get; set; }\n    public Course Course { get; set; }\n}\n")),(0,s.kt)("p",null,'Have on mind that all properties in domain classes must have nullability operator ("?") if it is not required (nullable); no matter if that property is value type or is reference type.'),(0,s.kt)("p",null,"All domain classes must be implemented in DbContext!"),(0,s.kt)("p",null,"After we built in conventions into classes + implement domain config files, implemented DbContext with all domain classes, created connection string and made changes in Program.cs file, we can start migrations."),(0,s.kt)("h3",{id:"codebook-tables"},(0,s.kt)("strong",{parentName:"h3"},"Codebook tables")),(0,s.kt)("p",null,"Codebook tables (hrv. \u0161ifrarnici) are tables in database which change never or rarely. For those tables in most cases you dont need all CRUD operations. You probably will need get API (depends on your business logic), but other APIs are not necessary because all data in that tables are mostly changed via direct SQL operations in database. Some examples ofcodebook tables: program types, genres, classes, academic years etc.\nIn .NET there is possibilty to insert data in codebooks at moment of creating database via migrations. That data is defined in DB context."),(0,s.kt)("h2",{id:"exercise-2-creating-migrations"},(0,s.kt)("strong",{parentName:"h2"},"Exercise 2: Creating Migrations")),(0,s.kt)("p",null,"Migrations are used to create and update the database schema based on your entity classes."),(0,s.kt)("p",null,"Preconditions:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Entity classes must be created")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"DbContext must be configured")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Connection string must be correct")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Entity Framework Core packages must be installed"))),(0,s.kt)("p",null,"We will use Package Manager Console to write commands. You can open it in Visual studio -> Tools -> NuGet Package Manager -> Package Manager Console"),(0,s.kt)("admonition",{type:"caution"},(0,s.kt)("mdxAdmonitionTitle",{parentName:"admonition"},(0,s.kt)("strong",{parentName:"mdxAdmonitionTitle"},"IMPORTANT")),(0,s.kt)("p",{parentName:"admonition"},"Set projects as shown on image below:")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"nuget",src:n(3876).Z,width:"1199",height:"830"})),(0,s.kt)("p",null,"Commands:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"Add-Migration InitialCreate\nUpdate-Database\n")),(0,s.kt)("p",null,"After running Add-Migration, a new folder called Migrations is created.\nThis folder contains auto-generated code that defines: Tables, Columns, Primary keys, Relationships and rules."),(0,s.kt)("p",null,"Running Update-Database applies these changes and creates the database on your SQL Server."),(0,s.kt)("p",null,"This process ensures that your database structure always matches your .NET code."))}p.isMDXComponent=!0},3876:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/migrations-projects-f7f7480a4cc33cbdf1f1347fafff0f83.PNG"}}]);